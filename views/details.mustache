<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ED-Market | All prices in one place</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/stylefix-details.css">

    <script src="./js/jquery-3.5.0.min.js"></script>
    <script src="./js/bootstrap.bundle.js"></script>
    <script src="./js/plotly-latest.min.js"></script>
    <script src="./js/datatables.min.js"></script>
</head>

<body>
    <video id="backvid" src="/videos/back.mp4" loop autoplay muted preload></video>
    <div class="backvid"></div>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="..">ED-Market</a>
    </nav>
    <div class="container">
        <div class="row justify-content-md-center align-middle">
            <div class="col col-lg-16">
                <h1>{{FullName}}</h1>
                <table id="table" class="table table-striped table-dark">
                    <thead>
                        <tr>
                            <th class="tablecell wide">Station</th>
                            <th class="tablecell wide">System</th>
                            <th class="tablecell">Disatance</th>
                            <th class="tablecell">Price/unit</th>
                            <th class="tablecell">Demand</th>
                            <th class="tablecell smalltab">L. Pad</th>
                            <th class="tablecell date">Updated</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#Stations}}
                        <tr>
                            <th>{{name}}</th>
                            <td>{{system}}</td>
                            <td>{{Distance}} Ls.</td>
                            <td>{{Max}} Cr.</td>
                            <td>{{Demand}}</td>
                            <td>{{pad}}</td>
                            <td>{{Updated}}</td>
                        </tr>
                        {{/Stations}}
                    </tbody>
                </table>
                <div id="chart" class="col-lg-16"></div>
            </div>
        </div>
        <script>
            let maincolor = ""

            const layout = {
                plot_bgcolor: "#1F1F1F50",
                paper_bgcolor: "#00000050",
                xaxis: {
                    gridcolor: 'rgba(58, 135, 236,0.5)',
                    linecolor: '#00000000',
                },
                yaxis: {
                    gridcolor: 'rgba(58, 135, 236,0.5)',
                    linecolor: '#00000000',
                },
                title: '{{FullName}} price chart',
                font: {
                    size: 16,
                    color: 'rgb(58, 135, 236)'
                }
            }
            const options = {
                scrollZoom: true,
                showLink: false,
                modeBarButtonsToRemove: ['toImage', 'zoom2d', 'pan', 'pan2d', 'autoScale2d'],
                displayLogo: false,
                displayModeBar: true,
            };
            let Plotdata = [{
                x: {{{ times }}},
            y: {{{ prices }}},
            type: 'scatter',
                line: {
                color: 'rgb(58, 135, 236)',
                    width: 2
            }
            }]
            Plotly.newPlot(document.querySelector("#chart"), Plotdata, layout, options);
            $(".modebar").hide();
            setInterval(() => {
                $.get("{{Name}}/Chart", (data) => {
                    Plotly.extendTraces(document.querySelector("#chart"), {
                        x: [[data[data.length - 1].date]],
                        y: [[data[data.length - 1].price]]
                    }, [0])


                })
            }, 1000 * 60);

            let table = $("#table").DataTable({
                "ajax": "{{Name}}/Partial"
            });
            
            setInterval(function () {
                table.ajax.reload(null,false);
            }, 5000);
            window.addEventListener('resize', () => { window.location.reload(); });
            table.order( [ 3, 'desc' ] ).draw( false );

        </script>
</body>

</html>